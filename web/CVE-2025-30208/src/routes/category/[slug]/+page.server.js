import { error } from '@sveltejs/kit';

export const load = async ({ params, fetch }) => {
  const { slug } = params;
  
  // Validate category
  const validCategories = ['tech', 'business', 'science', 'health', 'sports', 'entertainment'];
  if (!validCategories.includes(slug)) {
    throw error(404, 'Category not found');
  }
  
  try {
    // Fetch articles for this category
    const response = await fetch(`/api/news?category=${slug}&limit=20`);
    if (!response.ok) {
      throw new Error('Failed to fetch articles');
    }
    
    const data = await response.json();
    
    // Category metadata
    const categoryInfo = {
      tech: {
        name: 'Technology',
        description: 'Latest developments in tech, AI, and digital innovation',
        color: '#3b82f6'
      },
      business: {
        name: 'Business',
        description: 'Market updates, corporate news, and economic trends',
        color: '#10b981'
      },
      science: {
        name: 'Science',
        description: 'Scientific discoveries and research breakthroughs',
        color: '#8b5cf6'
      },
      health: {
        name: 'Health',
        description: 'Medical news and wellness insights',
        color: '#ef4444'
      },
      sports: {
        name: 'Sports',
        description: 'Athletic news and game highlights',
        color: '#f59e0b'
      },
      entertainment: {
        name: 'Entertainment',
        description: 'Movies, music, and cultural events',
        color: '#ec4899'
      }
    };
    
    return {
      articles: data.articles,
      category: {
        slug,
        ...categoryInfo[slug + ""]
      },
      total: data.total,
      hasMore: data.hasMore
    };
  } catch (err) {
    throw error(500, 'Failed to load category articles');
  }
};
